<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>13-SecondsToKill-</title>
    <style>
        *{  margin: 0;
            padding: 0;
            box-sizing: border-box;
            overflow: hidden;
        }
        body{
            background-color: black;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100vw;
            height: 100vh;
        }
        cnv{
            border: solid white 0.1vw;
        }
    </style>
</head>
<body>
    <script>
        var cnv = document.createElement("canvas");
        var ctx = cnv.getContext("2d");
        document.body.appendChild(cnv);
        cnv.width = 1024;
        cnv.height = 768;
    </script>
    <script src="scripts/functions.js"></script>
    <script src="scripts/hud.js"></script>
    <script src="scripts/sound/Zzfx.js"></script>
    <script src="scripts/graphics/particles.js"></script>
    <script src="scripts/graphics/functiondraw.js"></script>
    <script src="scripts/graphics/bossDraw.js"></script>
    <script src="scripts/tilesAndMap/drwTile.js"></script>
    <script src="scripts/entities.js"></script>
    <script src="scripts/tilesAndMap/levels.js"></script>
    <script src="scripts/tilesAndMap/map.js"></script>
    <script>
    var bli = 0;

    var lvls = [
    new lvl(new Map(lv1(fill(1))),0,0,{t:3,l:50},0,KCT),
        new lvl(new Map(lv2(fill(1))),0,0,{t:3,l:50},0,BTU),
        new lvl(new Map(lv3(fill(1))),1,0,{t:3,l:50},0,KCT),
        new lvl(new Map(lv4(fill(1))),0,0,{t:3,l:50},0,MORS),
        new lvl(new Map(lv5(fill(1))),0,0,{t:1,l:50},0,BTNS),
        new lvl(new Map(lv6(fill(1))),0,1,{t:1,l:50},0,KCT),
        new lvl(new Map(lv7(fill(1))),0,0,{t:1,l:50},0,MAT),
        new lvl(new Map(lv8(fill(12))),0,0,{t:1,l:50},0,KCT),
        new lvl(new Map(fill(1)),0,0,{t:1,l:50},1,),
        new lvl(new Map(fill(1)),0,0,{t:1,l:50},1,),
        new lvl(new Map(fill(1)),0,0,{t:1,l:50},1,),
        new lvl(new Map(fill(1)),0,0,{t:1,l:50},1,),
        new lvl(new Map(lv13(fill(1))),0,0,{t:1,l:50},0,function(){}),
    ]
    
    var tBX = {t:0 , sTX: "", aTX: "", clr:"", cTM :0},ENE = [], par = [], blo = [], clv = 0, enC = 0, c13 = 'green', cpd = 0,nxt = 0,dis = 200,rev = 0, tim = setInterval(menu,1000/30),pla = new Pla(cnv.width/2, cnv.height/3 , 64, 64),All = [],fric = [],hud = new Hud(), t = new Vec(0,0);
    //menu
    var plM = new Pla(cnv.width/2-100, cnv.height/2+100, 400, 400),a = {x:-127.5, y:500,w:cnv.width*1.25,h:cnv.width*1.25},b = {x:cnv.width/2 - cnv.width/3/2, y:650, w:cnv.width/3, lif:{c:0,m:0}},p = {x:0, y:0,w:cnv.width,h:cnv.height}
    //death
    var dBg = 0,dSb = 100,dt1 = 0, dt2 = 0, dSw = {x:cnv.width/2, y:cnv.height/2, w:200, h:200};

    const bu = zzfxM(...[[[1.5,0,130.8128,0.03,0.4,0.27,1,0.5,,,,,,0.1,,,0.07,0.64,0.04,,107],[1.1,0,65.40639,0.04,0.91,0.06,,1.2,,,,,0.4,0.1,,,,0.52,0.09,0.22],[1.3,0,65.40639132514966,,0.02,,,1.5,,,,,,5,,,,0.7,0.02],[0.5,0,260,,,0.04,,,,,,,0.1,99,,,,2,0.005,0.2]],[[[0,0,12,0,0,0,0,0,0,-1,13,0,0,0,0,0,0,-1],[0,0,,,,,15,0,0,0,0,0,0,-1,15,0,0,0],[2,0,12,-1,,,,,,,84,-1,,,,,,],[3,0,,,,,12,-1,,,,,,,12,-1,,]]],[0],120]);

    bu.loop = 1;
    var m = zzfxP(...bu);
    m.loop = 1;

    function menu()
    {   r(0,0,cnv.width,cnv.height,'black');
        for (let i = 0; i < 20; i++) par.push(new Par(p, 'pur',0,1));
        for(let i = 0; i<par.length; i++)   d(par[i],0,0) && par[i].drw();
        upT(par);
        
        sB(15,'purple')
        DFb(a);
        DFh(a);
        sB(0,'purple')
        sB(10,'purple');
        txt(cnv.width/2, cnv.height/8, '13-Seconds-To-Kill', cnv.width/10, 'purple');
        sB(0);
        plM.drw();
        sB(10, 'red');
        lB(b, 'purple',75,105,30,0);
        lB(b, wh,75,100,25,0);
        txt(cnv.width/2, cnv.height/1.34, 'press space to play', 40, blk);
        sB(0);
        if(key[32])
        {   clearInterval(tim);
            tim = setInterval(loop,1000/30);
        }
    }
    function loop()
    {   r(0,0,cnv.width,cnv.height,'black');
        fric = ENE.concat(pla,adi("box",lvls[clv].boxes));
        lvls[clv].upd();
        // console.log(cpd)

        for(let i = 0; i<blo.length; i++)
           d(blo[i],0,0) && blo[i].drw();
        
        All = ENE.concat(pla, pla.bal,adi("box",lvls[clv].boxes));
        All.sort((a,b) => a.y - b.y);

        for(let i = 0; i<All.length; i++)
            d(All[i], All[i].w, All[i].h) && All[i].drw();

        for(let i = 0; i<par.length; i++)
           d(par[i],0,0) && par[i].drw();

        for(var i = 0;i<adi("box",lvls[clv].boxes).length;i++)
            adi("box",lvls[clv].boxes)[i].upd();
           
        upT(pla.bal);
        upT(ENE);
        upT(par);
        pla.upd();
        
        !pla.dea && (ang = Math.atan2(mou.y - (pla.y), mou.x - (pla.x+pla.w/2)) + pi()*rev||pi()/2);
        pla.d.x = cos(ang);
        pla.d.y = sin(ang);
        if(key[87-rev*4])
            pla.spd.y > -pla.msp && (pla.spd.y -= pla.acel);
        if(key[83+rev*4])
            pla.spd.y < pla.msp && (pla.spd.y += pla.acel);
        if(key[65+rev*3])
            pla.spd.x > -pla.msp && (pla.spd.x -= pla.acel);
        if(key[68-rev*3])
            pla.spd.x < pla.msp && (pla.spd.x += pla.acel);

        hud.drw();
        r(0,0,cnv.width*rev,cnv.height*rev,'rgba(75,0,130,0.4)');
        drug();
        
        times && count();
        (tBX.t) ? (dlg(tBX.sTX, tBX.clr, tBX.t) , tBX.t--, document.addEventListener("keyup", dS)): ((tBX.aTX != "") ? adT(tBX.aTX, tBX.clr, tBX.cTM): null);
    }
    function dead(){
        if (dBg < 100) {
            dBg++;
            r(0,0,cnv.width,cnv.height,'black');
            lvls[clv].drw();
            for(let i = 0; i<blo.length; i++)
                d(blo[i],0,0) && blo[i].drw();
            
            All = ENE.concat(pla, pla.bal,adi("box",lvls[clv].boxes));
            All.sort((a,b) => a.y - b.y);

            for(let i = 0; i<All.length; i++)
                d(All[i], All[i].w, All[i].h) && All[i].drw();

            for(let i = 0; i<par.length; i++)
                d(par[i],0,0) && par[i].drw();

            for(var i = 0;i<adi("box",lvls[clv].boxes).length;i++)
                adi("box",lvls[clv].boxes)[i].upd();
            
            upT(pla.bal);
            upT(ENE);
            pla.upd();
            upT(par);
            (dBg == 99) && (par = []);
        } 
        else dt1 < 100 ? dt1++ : (dt2 < 100 ? dt2+=5 : null);
        
        r(0,0,cnv.width,cnv.height,'rgba(0,0,0,'+dBg/100+')');
        if (dt1 > 50) {
            dSb -= 2;
            swo(dSw, dSw.x-25, 0, 0,'red', 1);
            for(let i = 0; i<par.length; i++)
                d(par[i],0,0) && par[i].drw();
            upT(par);
            r(0,0,cnv.width,cnv.height,'rgba(0,0,0,'+dSb/100+')');
        }
        sB(10,'purple');
        txt(cnv.width/2, cnv.height-100, 'You are dead.', cnv.width/30, 'rgba(255,0,0,'+dt1/100+')');
        txt(cnv.width/2, cnv.height-50, 'The sword lays claim to your soul.', cnv.width/30, 'rgba(255,0,0,'+dt1/100+')');
        txt(cnv.width/2, 150, 'Press space to restart.', cnv.width/30, 'rgba(255,0,0,'+dt2/100+')');
        sB(0,'purple');

        if (dt2 == 100) (key[32]) && window.location.reload();
    }
    </script></body>
</html>