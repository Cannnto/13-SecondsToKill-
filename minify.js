var cnv=document.createElement("canvas"),ctx=cnv.getContext("2d");document.body.appendChild(cnv),cnv.width=1024,cnv.height=768,document.addEventListener("keydown",kD),document.addEventListener("keyup",kU),document.addEventListener("mousemove",mM),document.addEventListener("mouseup",mU),document.addEventListener("contextmenu",(t=>{t.preventDefault()}));var M=Math,key=[],mou={x:void 0,y:void 0},ang=0;function T(t,r){return r}function mU(t){0!=t.button||pla.dea||(pla.atk=1),2!=t.button||pla.amo.c||pla.dea||(pla.fAk=1)}function mM(t){mou.x=t.x-cnv.getBoundingClientRect().left,mou.y=t.y-cnv.getBoundingClientRect().top}function kD(t){key[t.keyCode]=!0}function kU(t){key[t.keyCode]=!1}function r(t,r,e,l,s){ctx.fillStyle=s,ctx.fillRect(t,r,e,l)}function bal(t,r,e,l){ctx.fillStyle=l,bP(),ctx.arc(t,r,e,0,2*M.PI),cP()}function eli(t,r,e,l,s,n){ctx.fillStyle=n,bP(),ctx.ellipse(t,r,e,l,s,0,2*M.PI),ctx.fill()}function d(t,r,e){return sqr((t.x+r/2-(pla.x+pla.w/2))**2+(t.y+e/2-(pla.y+pla.h/2))**2)*bli<dis}function drug(){let r=rng()*(rng()<.5?1:-1)*rev,e=rng()*(rng()<.5?1:-1)*rev;t.x+=r,t.y+=e,tra(r,e),!r&&(tra(-t.x,-t.y),t.mtp(0)),(abs(t.x)>2||abs(t.y)>2)&&(t.x-=r,t.y-=e,tra(-r,-e))}function sgr(t,r,e){for(var l=0;l<r.length;l++)for(var s=0;s<r[l].length;s++)r[l][s].constructor.name==t&&e.push(r[l][s])}function shf(t){let r=t.length;for(;r;){let e=M.floor(rng()*r);r--,[t[r],t[e]]=[t[e],t[r]]}}function adi(t,r){for(var e=[],l=0;l<r.length;l++)r[l]&&(e[l]=r[l][t]);return e}function dlg(t,e){r(0,cnv.height-100,cnv.width,100,"rgba(255,255,255,0.5)"),r(10,cnv.height-90,cnv.width-20,80,"rgba(0,0,0,0.5)"),txt(cnv.width/2,cnv.height-50,t,20,e)}function adT(t,r,e){var l=t,s=l.indexOf(";"),n=l.slice(0,s),c=l.slice(s+1);tBX.sTX=n,tBX.aTX=c,tBX.clr=r,tBX.t=e,tBX.cTM=e}function dS(t){67==t.keyCode&&(tBX.t=0),document.removeEventListener("keyup",dS)}function sav(){ctx.save()}function res(){ctx.restore()}function tra(t,r){ctx.translate(t,r)}function scl(t,r){ctx.scale(t,r)}function rtt(t){ctx.rotate(t)}function abs(t){return M.abs(t)}function bP(){ctx.beginPath()}function cP(){ctx.closePath(),ctx.fill()}function mT(t,r,e){ctx.fillStyle=e,bP(),ctx.moveTo(t,r)}function lT(t,r){ctx.lineTo(t,r)}function rng(){return rng()}function sin(t){return M.sin(t)}function cos(t){return M.cos(t)}function sqr(t){return M.sqrt(t)}function pI(t){return parseInt(t)}function sB(t,r){ctx.shadowColor=r,ctx.shadowBlur=t}class Atk{constructor(t,r,e,l){this.nam=t,this.tmr={c:30*r,m:30*r},this.act=e,this.atm={c:30*l,m:30*l}}}function adran(t,r,e){let l=0;for(;l<r;){let r=pI(20*rng()+2),s=pI(28*rng()+2);3!=t[r+1][s]&&3!=t[r-1][s]&&3!=t[r][s+1]&&3!=t[r][s-1]&&(1!=t[r][s]&&12!=t[r][s]||(t[r][s]=e,l++))}}var tles=[],tles2=[],mps=[],times=[],endTimes=[];function change(t,r,e){var l=tles2.indexOf(lvls[clv].map.arr[t.l][t.c]);-1==l&&"Wal"!=lvls[clv].map.arr[t.l][t.c].constructor.name?(tles.push(lvls[clv].map.arr[t.l][t.c]),lvls[clv].map.arr[t.l][t.c]=r,mps.push(t),tles2.push(lvls[clv].map.arr[t.l][t.c]),times.push(0),endTimes.push(e)):"Wal"!=lvls[clv].map.arr[t.l][t.c].constructor.name&&(lvls[clv].map.arr[t.l][t.c]=r,tles2[l]=lvls[clv].map.arr[t.l][t.c],times[l]=0,endTimes[l]=e)}function count(){for(var t=0;t<times.length;t++)times[t]>=endTimes[t]?(lvls[clv].map.arr[mps[t].l][mps[t].c]=tles[t],tles2.splice(t,1),tles.splice(t,1),endTimes.splice(t,1),times.splice(t,1),mps.splice(t,1),t--):(tles[t].constructor.name==tles2[t].constructor.name&&(tles2.splice(t,1),tles.splice(t,1),endTimes.splice(t,1),times.splice(t,1),mps.splice(t,1),t--),times[t]++)}class Hud{constructor(){}drw(){sB(5,"black"),mT(104,48,"white"),lT(159,48),lT(169,48),lT(159,64),lT(104,64),cP();let t=pla.amo.c/pla.amo.m;!t&&(t=1),mT(104,48,"orange"),lT(104+55*t,48),lT(104+65*t,48),lT(104+55*t,64),lT(104,64),cP(),mT(104,32,"white"),lT(214,32),lT(224,40),lT(214,48),lT(104,48),cP(),mT(104,32,"red"),lT(104+110*pla.tim.c/pla.tim.m,32),lT(104+120*pla.tim.c/pla.tim.m,40),lT(104+110*pla.tim.c/pla.tim.m,48),lT(104,48),cP(),sB(0),heF({x:8,y:80,w:128,h:128},1*pla.tim.c/pla.tim.m||.001)}}zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let r=zzfxX.createBufferSource(),e=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map(((t,r)=>e.getChannelData(r).set(t))),r.buffer=e,r.connect(zzfxX.destination),r.start(),r},zzfxG=(t=1,r=.05,e=220,l=0,s=0,n=.1,c=0,a=1,h=0,i=0,w=0,x=0,o=0,d=0,p=0,y=0,u=0,f=1,v=0,m=0)=>{let b,g,T=2*M.PI,C=h*=500*T/zzfxR**2,k=(0<p?1:-1)*T/4,B=e*=(1+2*r*rng()-r)*T/zzfxR,z=[],P=0,D=0,A=0,I=1,E=0,F=0,S=0;for(l=99+zzfxR*l,v*=zzfxR,s*=zzfxR,n*=zzfxR,u*=zzfxR,i*=500*T/zzfxR**3,p*=T/zzfxR,w*=T/zzfxR,x*=zzfxR,o=zzfxR*o|0,g=l+v+s+n+u|0;A<g;z[A++]=S)++F%(100*y|0)||(S=c?1<c?2<c?3<c?M.sin((P%T)**3):M.max(M.min(M.tan(P),1),-1):1-(2*P/T%2+2)%2:1-4*M.abs(M.round(P/T)-P/T):M.sin(P),S=(o?1-m+m*M.sin(2*M.PI*A/o):1)*(0<S?1:-1)*M.abs(S)**a*t*zzfxV*(A<l?A/l:A<l+v?1-(A-l)/v*(1-f):A<l+v+s?f:A<g-u?(g-A-u)/n*f:0),S=u?S/2+(u>A?0:(A<g-u?1:(g-A)/u)*z[A-u|0]/2):S),b=(e+=h+=i)*M.sin(D*p-k),P+=b-b*d*(1-1e9*(M.sin(A)+1)%2),D+=b-b*d*(1-1e9*(M.sin(A)**2+1)%2),I&&++I>x&&(e+=w,B+=w,I=0),!o||++E%o||(e=B,h=C,I=I||1);return z},zzfxV=.3,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext),zzfxM=(t,r,e,l=125)=>{let s,n,c,a,h,i,w,x,o,d,p,y,u,f,v,m=0,b=[],g=[],T=[],C=0,k=0,M=1,B={},z=zzfxR/l*60>>2;for(;M;C++)b=[M=x=p=u=0],e.map(((l,p)=>{for(w=r[l][C]||[0,0,0],M|=!!r[l][C],v=u+(r[l][0].length-2-!x)*z,f=p==e.length-1,n=2,a=u;n<w.length+f;x=++n){for(h=w[n],o=n==w.length+f-1&&f||d!=(w[0]||0)|h,c=0;c<z&&x;c++>z-99&&o?y+=(y<1)/99:0)i=(1-y)*b[m++]/2||0,g[a]=(g[a]||0)-i*k+i,T[a]=(T[a++]||0)+i*k+i;h&&(y=h%1,k=w[1]||0,(h|=0)&&(b=B[[d=w[m=0]||0,h]]=B[[d,h]]||(s=[...t[d]],s[2]*=2**((h-12)/12),h>0?zzfxG(...s):[])))}u=v}));return[g,T]};var hitS=zzfxG(...[2,,172,.02,.05,.02,1,.2,1,,,,,1.2,10,.5,,.92,.08]),dieS=zzfxG(...[2,,31,.04,.1,.71,4,.1,5,6,,,,1.1,,1,,.35,.25,.19]),firS=zzfxG(...[2,.1,50,.06,.01,.69,4,.8,-.1,-1.8,50,-.99,,,1.2,.2,,.1,,,233]),dorS=zzfxG(...[2,,100,.1,.4,.6,4,1.5,,.3,,-.2,,.3,.5,.3,,.7,.1]);function upT(t){for(let r=0;r<t.length;r++)t[r].upd(),t[r].die()&&(t.splice(r,1),r--)}class Par{constructor(t,r,e,l,s){if(this.x=t.x+rng()*t.w,this.y=t.y+rng()*t.h,this.vx=2*rng()-1,this.vy=4*rng()-5,this.a=1,this.r=3,l&&(this.r=10,this.vy=40*-rng()),s&&(this.r=5),this.w=t.w,this.h=t.h,this.cor=r,this.e=t,this.cen=e,e){var n=100*rng(),c=rng()*(2*M.PI),a={x:n*cos(c),y:n*sin(c)};this.x+=a.x,this.y+=a.y}}die(){return this.a<0}upd(){this.cen?this.upd=function(){var t=M.sqrt((this.cen.x-this.x)**2+(this.cen.y-this.y)**2)/50,r=M.atan2(2*(this.cen.y-this.y),2*(this.cen.x-this.x)),e=t*cos(r)*5,l=t*sin(r)*5;this.x+=e,this.y+=l,this.a-=.03}:this.upd=function(){this.x+=this.vx,this.y+=this.vy*(1-2*rev),this.a-=.03,this.r>1&&(this.r-=.05+.05*rng())}}drw(){switch(this.cor){case"red":this.drw=function(){bal(this.x,this.y,this.r,`rgba(${100+255*rng()}, 10, 10, ${this.a})`)};break;case"ora":this.drw=function(){bal(this.x,this.y,this.r,`rgba(${200+30*rng()}, ${50+100*rng()}, 10, ${this.a})`)};break;case"pur":this.y=this.e.y+this.e.h,this.drw=function(){bal(this.x,this.y,this.r,`rgba(${60+200*rng()}, ${115*rng()}, 255, ${this.a})`)};break;case"bla":this.y=this.e.y+this.e.h,this.drw=function(){bal(this.x,this.y,this.r,`rgba(${10*rng()}, ${10*rng()}, ${10*rng()}, ${this.a})`)};break;case"blu":this.y=this.e.y+this.e.h,this.drw=function(){bal(this.x,this.y,this.r,`rgba(10, ${50+100*rng()}, ${200+30*rng()}, ${this.a})`)};break;case"gre":this.y=this.e.y+this.e.h,this.drw=function(){bal(this.x,this.y,this.r,`rgba(${0+50*rng()}, ${100+255*rng()}, ${0+50*rng()}, ${this.a})`)}}}}class Blo{constructor(t){this.x=t.x+rng()*t.w,this.y=t.y+rng()*t.h,this.r=7.5*rng(),this.c=`rgb(${100+155*rng()}, 10, 10)`}drw(){bal(this.x,this.y,this.r,this.c)}}var zC="#3A4A13",blk="black",wh="white";function i(t){return x=t.x,y=t.y,w=t.w,h=t.h}function Ddi(t){let r=0;for(;r<10;){let e=pI(22*rng()),l=pI(30*rng());1==t[e][l]&&(t[e][l]=11,r++)}}function gr(t){r(t.x,t.y,32,32,"#24282E")}function txt(t,r,e,l,s){ctx.font=`${l}px Trebuchet MS`,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle=s,ctx.fillText(e,t,r)}function mov(t){sav(),tra(t.x+t.w/2,t.y+t.h/2),rtt(t.cnt*M.PI/180),tra(-(t.x+t.w/2),-(t.y+t.h/2))}function cha(t){sav(),t.c&&(tra(t.x+t.w/2,t.y+t.h/2),scl(-1,1),tra(-(t.x+t.w/2),-(t.y+t.h/2)))}function RTT(t,r){sav(),tra(t.x+t.w/2,t.y+t.h/2),rtt(r*M.PI/180),tra(-(t.x+t.w/2),-(t.y+t.h/2))}function SCL(t,r){sav(),tra(t.x+t.w/2,t.y+t.h/2),scl(r,r),tra(-(t.x+t.w/2),-(t.y+t.h/2))}function hed(t,e){r(t.x+t.w/4,t.y-t.h/2,t.w/2,t.h/2,`rgba(255,255,255,${e||1})`)}function pnt(t){r(t.x+.5*t.w/4,t.y+2.5*t.h/4,3*t.w/4,t.h/4,"#055769")}function shr(t,e){r(t.x+.5*t.w/4,t.y,3*t.w/4,1.25*t.h/2,e)}function eye(t,e,l,s,n){r(t.x+t.w*e,t.y-t.h*l+s,t.w/8,1.3*t.h/8,n)}function heZ(t,e){i(t),r(x+w/4-.5,y-.5+e,w/2+1,h/2+1,blk),r(x+2*w/8,y+e,3*w/8,h/2,zC),r(x+5*w/8-1,y+h/8+e,w/8+1,1.5*h/4,zC)}function heS(t,e){i(t),hed(t),r(x+2*w/8,y-4*h/8,4*w/8,.75*h/8+1,"#D9D9D9"),r(x+2*w/8,y-3.25*h/8,3*w/8,h/16+1),r(x+2*w/8,y-2.75*h/8,w/8,h/8+1),r(x+2.5*w/4,y-2.35*h/8,w/8,1.3*h/8,blk),r(x+w/4,y-h/2,w/2*e,h/10*e,"red"),r(x+w/4,y-h/2,w/13*e,h/4*e,"red"),r(x+w/3.3,y-h/2,w/13*e,h/6*e,"red"),r(x+w/1.7,y-h/2,w/13*e,h/4*e,"red")}function le1(t,e,l){i(t);let s={x:x+.75*w/4,y:y+3*h/4,w:1.25*w/4*2,h:-h/4*2};RTT(s,-5*e),r(s.x,s.y,s.w/2,-s.h/2,l),res()}function hs1(t,e,l){i(t),r(x+3*w/4+e,y,w/4,h/4,l)}function geS(t,e,l,s){i(t),r(x+4.15*w/4-w/14+e,y+h*l/7,w/14,h/14,s)}function gaS(t,e){i(t),r(x+3*w/4+e,y,w/3.5,h/3.5,"#46464b"),r(x+4.15*w/4-w/7+e,y+1*h/3.5-h/14,w/7,h/14,blk),geS(t,e,0,"#0000FF"),geS(t,e,.1,"#FF0000"),geS(t,e,.2,"#00FF00")}function hs2(t,e,l,s,n){i(t);let c={x:x+2*w/4,y:y+.5*h/4-e,w:-w/4*2,h:-h/4*2};RTT(c,-10*e+s),r(c.x,c.y,-c.w/2,-c.h/2,l),r(c.x-c.w/2/10,c.y,-c.w/2/1.3*n,-c.h/2/4*n,"red"),r(c.x-c.w/2/4,c.y,-c.w/2/4*n,-c.h/2*n,"red"),res()}function le2(t,e,l,s){i(t);let n={x:x+2*w/4,y:y+3*h/4,w:-1.25*w/4*2,h:-h/4*2};RTT(n,5*e),r(n.x,n.y,-n.w/2,-n.h/2,l),r(n.x-n.w/4,n.y,-n.w/2/2*s,-n.h/2/4*s,"red"),r(n.x-n.w/2.7,n.y,-n.w/2/4*s,-n.h/2/1.5*s,"red"),res()}function bdS(t,e,l,s,n){i(t);var c={x:x+.3*w/4,y:y,w:3.4*w/4,h:h};shr(c,e),s&&(r(x+3*w/4-.5,y-.5+n,w/4+1,h/2+1,blk),r(x+3*w/4,y+n,w/4,h/2,zC),eye(t,7/8,-1.35/8,n,"red")),!s&&r(x+3.25*w/4,y-.1*h/2,2,1.2*h/2,"#D9D9D9"),r(x+.75*w/4-.5,y-.1*h/2-.5,2.5*w/4+1,1.2*h/2+1,blk),r(x+.75*w/4,y-.1*h/2,2.5*w/4,1.2*h/2,l),pnt(c)}function heB(t,e){i(t),hed(t),r(x+2*w/8,y-4*h/8,4*w/8,2.25*h/8,"#D9D9D9"),r(x+4*w/8-1,y-4*h/8-1,(2*w/8+2)*e,(4*h/8+2)*e,zC),r(x+2*w/8,y-4*h/8,1*w/16*e,2*h/8*e,"red"),r(x+2*w/8,y-4*h/8,2*w/16*e,1*h/12*e,"red")}function bdB(t,e,l,s){i(t),shr(t,e),r(x+.5*w/4-.5,y-.1*h/2-.5,3*w/4/2+1,1.2*h/2+1,blk),r(x+.5*w/4,y-.1*h/2,3*w/4/2,1.2*h/2,l),r(x+.5*w/4-.5,y-.1*h/2-.5,(3*w/4+1)*s,(1.2*h/2+1)*s,blk),r(x+.5*w/4,y-.1*h/2,3*w/4*s,1.2*h/2*s,l),pnt(t)}function heF(t,e){i(t),hed(t,e),eye(t,2.75/8,2.35/8,0,`rgba(0,0,0,${e||1})`),eye(t,4.25/8,2.35/8,0,`rgba(0,0,0,${e||1})`),r(x+2*w/8,y-4*h/8,4*w/8,.75*h/8,`rgba(217,217,217,${e||1})`),r(x+5*w/8,y-3.25*h/8,w/8,h/16),r(x+2*w/8,y-3.25*h/8,w/8,h/16)}function cHe(t){i(t),r(x+w/4-1,y-h/2-1,w/4+2,h/2+2,zC),r(x+2.4*w/8,y-2.9*h/8,w/6,1.5*h/8,"red"),r(x+3*w/4-w/16,y-h/2,w/16,h/4,"red"),r(x+3*w/4-w/8,y-h/2,w/8,h/16,"red")}function ZhF(t,r){heZ(t,r),eye(t,2.75/8,-1.35/8,r,"red"),eye(t,4.25/8,-1.35/8,r,"red")}function bdF(t){i(t),shr(t,"#6F6F6F");let e={w:w/4,h:1.2*h/2,y:.1*h/2};r(x+.5*w/4,y-e.y-.5,e.w+1,e.h+1,blk),r(x+.5*w/4,y-e.y,e.w,e.h,"#424242"),r(x+w/3,y-e.y,2,e.h,"#D9D9D9"),siJ(t,"#424242"),pnt(t)}function siJ(t,e){i(t);let l={w:w/4,h:1.2*h/2,y:.1*h/2};r(x+2.5*w/4-1,y-l.y-.5,l.w+1,l.h+1,blk),r(x+2.5*w/4,y-l.y,l.w,l.h,e),r(x+2*w/3-2,y-l.y,2,l.h,"#D9D9D9")}function han(t,e,l,s,n,c){i(t),r(l+x,y+.5*h/4-e+s/4,w/4,h/4,n),r(l+x,y+.5*h/4-e+s/4,w/16*c,h/8*c,"red"),r(l+x+3*w/16,y+.5*h/4-e+s/4,w/16*c,h/4.5*c,"red")}function gem(t,e,l,s){i(t),r(l+x,y+.4*h/3.5-e,w/14,h/14,s)}function gau(t,e,l){i(t),r(x+l,y+.35*h/3.5+e,w/3.5,h/3.5,"#46464b"),gem(t,-e,l+w/64,"#0000FF"),gem(t,-e,l+w/3.5/2-w/14/2,"#FF0000"),gem(t,-e,l+w/3.5/2+w/18,"#0000FF"),!(t.a==t.bac)&&r(x+w/7+l,y+1.1*h/3.5+e,w/7,h/14,blk),gem(t,-e,l+w/3.5/2+w/18,"#00FF00")}function HAN(t,r,e,l){han(t,-r,0,0,e,0),han(t,r,3*t.w/4,0,e,l)}function leg(t,e,l,s,n,c){i(t);let a={x:x+.5*w/4,y:y+3*h/4,w:1.25*w/4,h:-h/4*2},o={x:x+2.25*w/4,y:a.y,w:a.w,h:a.h};SCL(a,e),r(a.x,a.y,a.w,-a.h/2,s),res(),SCL(o,l),r(o.x,o.y,o.w,-o.h/2,n),r(o.x,o.y,o.w/6*c,-o.h/3*c,"red"),r(o.x,o.y,o.w/1.5*c,-o.h/12*c,"red"),r(o.x,o.y,o.w/3*c,-o.h/6*c,"red"),res()}function swo(t,e,l,s,n,c){i(t);let a={x:x+2*w/4,y:y+.5*h/4,w:-w/4*2,h:-h/4*2};var o=0;t.a!=t.sid&&(o=s/4),t.a==t.sid&&RTT(a,-10*l+s),r(e-2.5,y+h/16-l+o,w/4+5,h/16,blk),r(e+w/10,y+.5*h/4-l+o,w/16,h/4,"#552A18"),r(e+w/16,y+1.5*h/4-l+o,w/8,h/8,"#6F6F6F"),mT(e+w/24,y-4*h/8+.5-l+o,n),lT(e+w/8,y-6*h/8+.5-l+o),lT(e+w/4.8,y-4*h/8+.5-l+o),cP(),r(e+w/24,y-h/2-l+o,w/6,9*h/16,n);var d=-0*l*M.PI/180;t.a==t.sid&&(res(),d=(-10*l+s)*M.PI/180);let p={x:e+w/24,y:y-h/2-l+o+20*sin(d),w:w/6,h:9*h/16},u={x:e+w/24-5.1*h/8,y:y-h/2-l+5*sin(d),w:p.h,h:p.w};t.c&&(p.x-=w/4,u.x+=u.w);let f=p;if(180*d/M.PI<-45&&(f=u),t.dea)for(let t=0;t<5;t++)par.push(new Par(f,"red",{x:p.x+p.w/2,y:p.y+p.h/2}));if(c||bli)for(let t=0;t<5;t++)pla.dea?par.push(new Par(f,"ora",0,0,1)):par.push(new Par(f,"ora"))}function sla(t){i(t),ctx.fillStyle="red",RTT(t,180*ang/M.PI),bP(),mT(x,y),lT(x+w/2,y+h/6),lT(x+w,y+h/2),lT(x+w/2,y+h/1.2),lT(x,y+h),lT(x+w/3,y+h/1.3),lT(x+w/2,y+h/2),lT(x+w/3,y+h/4),cP(),res(),ctx.fill()}function box(t){i(t);let e={x:x+w/2-w/16,y:y+w/3-6,w:w/8,h:h},l={x:x+w/2-w/16,y:y-7.5,w:w/16,h:h/1.2},s="#E29628",n="#B5701D";r(x,y,w,h,"#995F12"),RTT(e,-60),r(e.x,e.y,e.w,e.h,n),res(),RTT(l,82),r(l.x,l.y,l.w,l.h,n),res(),r(x+1,y+1,w/8-2,h-2,s),r(x+1,y+1,w-2,h/12-2,s),r(x+1,y+h/4+1,w-2,h/8-2,s),r(x+1+.875*w,y+1,w/8-2,h-2,s),r(x+1,y+.875*h+1,w-2,h/8-2,s)}function int(t){i(t),txt(x+w/2,y-h/1.1,"[E]",w/2,wh)}function lB(t,r,e,l,s,n){i(t);let c=t.lif.c/t.lif.m*n||1;sB(3,blk),mT(x,y-e-s,r),lT(x+w*c,y-e-s),lT(x-l+(w+2*l)*c,y-e),lT(x+w*c,y-e+s),lT(x,y-e+s),lT(x-l,y-e),cP(),sB(0,blk)}function DFb(t){i(t),Dbd(t,0),sB(10,"black"),r(x+2*w/5,y,w/5,h,"black"),de1(0),de2(0),RTT(t,180),de1(0),de2(0),res(),sB(8,"red"),mT(x+2.3*w/5,y,"#880D41"),lT(x+2.8*w/5,y),lT(x+2.5*w/5,y+h),cP(),sB(0),spk(t,0),spk(t,w/1.6)}function DFh(t){i(t),sB(10,"black"),mT(x+1.5*w/5,y,"black"),lT(x+1.5*w/5,y-h/3.25),lT(x+2*w/5,y-h/2.75),lT(x+3*w/5,y-h/2.75),lT(x+3.5*w/5,y-h/3.25),lT(x+3.5*w/5,y),cP(),r(x+w/2-w/16/2,y-h/4,w/16,h/32,"#FF8E54"),r(x+w/2-w/16/2,y-h/4-h/32,w/16,h/32,"#EC082A"),r(x+w/2-w/16/2,y-h/4+h/32,w/16,h/32,"#EC082A"),r(x+w/2+w/16/2,y-h/4,w/16,h/32,"#EC082A"),r(x+w/2-w/5.4/2,y-h/4,w/16,h/32,"#EC082A"),sB(0),r(x+w/2+w/16/2,y-h/4+h/32,w/32,h/32,"#670816"),r(x+w/2+w/16/2,y-h/4-h/32,w/32,h/32,"#670816"),r(x+w/2-w/8/2,y-h/4+h/32,w/32,h/32,"#670816"),r(x+w/2-w/8/2,y-h/4-h/32,w/32,h/32,"#670816")}function Dbd(t,r,e){i(t),eli(x+w/2,y-h/12,w/2.25*!r,h/4.5*!r,0,"#450462"),eli(x+w/2,y-h/12,w/2.8*!r,h/4.6*!r,0,"black"),ctx.fillStyle="#450462",bP(),ctx.ellipse(x+w/2,y-h/12,w/2.25*r,h/4.5*r,0,M.PI-60*M.PI/180,2*M.PI-30*M.PI/180),ctx.fill(),mT(x+1*w/5,y,"#28013A"),lT(x+1.5*w/5,y-h/2),lT(x+3.5*w/5,y-h/2),lT(x+4*w/5,y),cP(),eli(x+w/2,y-h/12,w/2.25*e,h/4.5*e,0,"#450462"),mT(x+.9*w/5,y+h/8,"#450462"),lT(x+.3*w/5,y-h/32),lT(x+4.7*w/5,y-h/32),lT(x+4.1*w/5,y+h/8),cP(),mT(x,y+h,"#450462"),lT(x+1*w/5,y),lT(x+4*w/5,y),lT(x+w,y+h),cP(),mT(x+.9*w/5,y+h/9,"#28013A"),lT(x+4.1*w/5,y+h/9),lT(x+4.2*w/5,y+h/6),lT(x+.8*w/5,y+h/6),cP()}function de1(t){mT(t+x+1.5*w/5,y,"black"),lT(t+x+2*w/5,y),lT(t+x+2*w/5,y+h/4),lT(t+x+1.8*w/5,y+h/16),cP()}function de2(t){mT(t+x+3.5*w/5,y,"black"),lT(t+x+3*w/5,y),lT(t+x+3*w/5,y+h/4),lT(t+x+3.2*w/5,y+h/16),cP()}function spk(t,r){i(t),mT(r+x,y+h/1,"black"),lT(r+x+w/16,y+h/1.15),lT(r+x+w/16,y+h/1.1),lT(r+x+1*w/16,y+h/1.02),lT(r+x+2*w/16,y+h/1.07),lT(r+x+2.5*w/16,y+h/1.02),lT(r+x+4*w/16,y+h/1.08),lT(r+x+6*w/16,y+h/1),cP()}function stf(t,r,e){i(t),t.c=e;let l=0,s={x:x+2*w/4,y:y+.5*h/4-r,w:-w/4*2,h:-h/4*2};t.a==t.sid&&(RTT(s,-10*r),l=15),cha(t),sB(5,"red"),mT(x+3*w/4-l,y+h/1.05-r,"#880D41"),lT(x+3.4*w/4-l,y+h/5-r),lT(x+3.5*w/4-l,y-h/4-r),lT(x+4.5*w/4-l,y-h/3.5-r),lT(x+4.75*w/4-l,y-h/2-r),lT(x+5*w/4-l,y-h/2-r),lT(x+4*w/4-l,y-h/5-r),lT(x+3.75*w/4-l,y+h/5-r),lT(x+3.4*w/4-l,y+h/1.05-r),cP(),sB(0),sB(10,"red"),bal(x+3.75*w/4-l,y-h/2-r,w/8,"white"),sB(0),res(),t.a==t.sid&&res(),t.c=0}function waF(t){i(t),r(x,y+h-1,w,1,"black"),r(x,y,w,1),wLi(x,y),r(x,y+1*h/3,h,1),wLi(x+1*w/8,y+1*h/3),r(x,y+2*h/3,h,1),wLi(x+1*w/32,y+2*h/3)}function wLi(t,e){r(t,e,1,10.6),r(t+8,e,1,10.6),r(t+16,e,1,10.6),r(t+24,e,1,10.6)}function waS(t){i(t),r(x,y,32,32,"#20252E"),r(x,y,1,32,"#6D798B"),r(x+31,y,1,32)}function nex(t,r,e){if(i(t),lvls[clv].map.arr[y/32+e]&&lvls[clv].map.arr[y/32+e][x/32+1*r])return"Wal"==lvls[clv].map.arr[y/32+e][x/32+1*r].constructor.name}function dir(t,e){i(t),RTT(t,e),r(x+.4*w/3,y+1.6*h/3,w/5,h/5,"#4C4C4C"),r(x+1.7*w/3,y+2*h/3,w/3,h/4,"#4C4C4C"),r(x+.2*w/3,y+.2*h/3,w/3,h/3,"#333333"),r(x+2*w/3,y+.5*h/3,w/4,h/5,"#333333"),res()}function btn(t,e){i(t),eli(x+w/2,y+h/2,w/3,h/8,0,e),eli(x+w/2,y+h/1.2,w/2.5,h/5,0,"gray"),eli(x+w/2,y+h/1.2,w/3,h/8,0,e),r(x+w/6,y+h/2,w/1.5,h/3,e)}function spw(t){i(t),r(x+w/8,y+h/8,.75*w,.75*h,"#C6C6C8"),r(x+w/8,y+h/8,.75*w/8,.75*h,"red"),r(x+w/8,y+h/8,.75*w/4,.75*h/2.5,"red"),r(x+.05*w,y+h/1.5,.9*w,h/4,"#D9D9D9")}function sgn(t){i(t),r(x,y,w,h/1.75,"#7C653C"),r(x+w/2.2,y,w/8,h,"#7C653C"),r(x+.1*w,y+h/1.75*.5/4,.8*w,h/3/4,"#574220"),r(x+.1*w,y+h/1.75*1.75/4,.8*w,h/3/4,"#574220"),r(x+.1*w,y+h/1.75*3/4,.8*w,h/3/4,"#574220")}function bdt(t,r){i(t),X(r),RTT(t,90),X(r),res()}function X(t){mT(x,y+h/1.25,t),lT(x+w/1.25,y),lT(x+w,y),lT(x+w,y+.25*h),lT(x+.25*w,y+h),lT(x,y+h),cP()}function cnt(t,e,l){i(t),r(x+1,y+1,w-2,h-2,"#20252E"),sB(5,"black"),txt(x+w/2,y+h/2,e,w/1.25,l),sB(0)}function mor(t){i(t),r(x+w/2-w/1.5/2,y-h/3,w/1.5,h/2,blk),txt(x+w/2,y-h/3,t.val[t.i%t.val.length],w,wh)}function mat(t){i(t),r(x+1,y+1,w-2,h-2,"#30353D")}class Vec{constructor(t,r){this.x=t,this.y=r}sum(t){this.x+=t.x,this.y+=t.y}div(t){this.x/=t,this.y/=t}mtp(t){this.x*=t,this.y*=t}lim(t){let r=this;r.x=M.min(M.max(r.x,-t),t),r.y=M.min(M.max(r.y,-t),t)}}class Ent{constructor(t,r,e,l){let s=this;s.x=t,s.y=r,s.w=e/2,s.h=l/2,s.d=new Vec(0,0),s.spd=new Vec(0,0),s.c=0,s.cn=1,s.rot=0,s.fri=0}drw(){let t=this;t.d.x&&(t.a=t.sid,t.c=0,t.d.x<0&&(t.c=1)),t.d.y>0&&abs(t.d.y)>abs(t.d.x)&&(t.a=t.fro,t.c=0),t.d.y<0&&abs(t.d.y)>abs(t.d.x)&&(t.a=t.bac,t.c=0),t.spd.x||t.spd.y?(t.cn++,t.rot&&(t.cn-=2),(t.cn>=3||t.cn<=-3)&&(t.rot=!t.rot)):t.cn>0?t.cn-=.25:t.cn<0&&(t.cn+=.25),t.a()}a(){this.fro()}cld(t){let r=this;for(let e=0;e<t.length;e++)if(r.x+r.w>=t[e].x&&r.x<=t[e].x+t[e].w&&r.y+r.h>=t[e].y&&r.y<=t[e].y+t[e].h)return 1}u(t){return lvls[clv].map.arr[t.l][t.c].col||"dor"==lvls[clv].map.arr[t.l][t.c].constructor.name}CWL(){let t=this;return t.mp1={c:pI(t.x/32),l:pI(t.y/32)},t.mp2={c:pI((t.x+t.w)/32),l:pI(t.y/32)},t.mp3={c:pI((t.x+t.w)/32),l:pI((t.y+t.h)/32)},t.mp4={c:pI(t.x/32),l:pI((t.y+t.h)/32)},t.u(t.mp1)||t.u(t.mp2)||t.u(t.mp3)||t.u(t.mp4)}}class Pla extends Ent{constructor(t,r,e,l){super(t,r,e,l);let s=this;s.atC=0,s.fAC=0,s.fsw=0,s.bal=[],s.msp=5,s.int=0,s.ice=0,s.tim={c:1/0,m:1/0},s.amo={c:0,m:60},s.dea=0,s.deC=0}sid(){let t=this;cha(t),hs1(t,t.cn,wh),le1(t,t.cn,wh),mov(t),heS(t),bdS(t,"#6F6F6F","#424242",0),res(),swo(t,t.x+2*t.w/4,t.cn,t.atC,"red",t.fsw),hs2(t,t.cn,wh,t.atC,0),le2(t,t.cn,wh,0),res()}bac(){let t=this;swo(t,t.x,-t.cn,t.atC,"red",t.fsw),han(t,-t.cn,0,t.atC,wh,0),han(t,t.cn,3*t.w/4,0,wh,0),leg(t,t.cn<0?.8:t.cn?1.2:1,t.cn>0?.8:t.cn?1.2:1,wh,wh,0),mov(t),heB(t,"#424242"),bdB(t,"#6F6F6F","#424242",1),res()}fro(){let t=this;mov(t),heF(t),bdF(t),res(),han(t,t.cn,3*t.w/4,t.atC,wh,0),han(t,-t.cn,0*t.w/4,0,wh,0),swo(t,t.x+3*t.w/4,t.cn,t.atC,"red",t.fsw),leg(t,t.cn<0?.8:t.cn?1.2:1,t.cn>0?.8:t.cn?1.2:1,wh,wh,0)}ATK(){let t=this;var r={x:t.x+40*t.d.x,y:t.y+60*t.d.y-t.h/2,w:t.h,h:1.5*t.w};sla(r),zzfxP(hitS);for(var e=0;e<lvls[clv].boxes.length;e++)lvls[clv].boxes[e].box.cld([r])&&(lvls[clv].boxes[e].box.x=lvls[clv].boxes[e].box.spX,lvls[clv].boxes[e].box.y=lvls[clv].boxes[e].box.spY);for(e=0;e<ENE.length;e++)ENE[e].cld([r])&&(ENE[e].lif.c-=50)}fir(){let t=this;zzfxP(firS),t.bal.push(new Ball(t.x+t.w/2,t.y,16,16,ang)),t.amo.c++}move(t){let r=this;r.x+=r.spd.x*abs(r.spd.x/r.len)*t,r.y+=r.spd.y*abs(r.spd.y/r.len)*t}upd(){let t=this;t.amo.c&&t.amo.c++,t.amo.c==t.amo.m&&(t.amo.c=0),t.atA&&(t.atC+=20,t.atk=0,t.atC>0&&(t.atC=0,t.ATK(),t.atA=0)),t.atk&&(t.atC-=15,t.atC<-90&&(t.atA=1)),t.fAk&&!t.amo.c&&(t.fAC++,t.fsw=1,t.fAC>30&&(t.fsw=0,t.fAC=0,t.fAk=0,t.fir())),t.dea&&(key=[],t.spd.mtp(0),ang=M.PI/2,t.deC++,t.deC>120&&(clearInterval(tim),tim=setInterval(dead,1e3/30))),t.int&&int(t),t.int=0,t.len=t.spd.x||t.spd.y?sqr(t.spd.x**2+t.spd.y**2):1,t.move(1),t.CWL()&&(t.move(-1),t.spd.mtp(0));for(var r=0;r<lvls[clv].boxes.length;r++)t.cld([lvls[clv].boxes[r].box])&&(lvls[clv].boxes[r].box.psh(t,t.d.x,t.d.y),t.move(-1));t.spd.x*=t.fri,t.spd.y*=t.fri,abs(t.spd.x)<.05&&(t.spd.x=0),abs(t.spd.y)<.05&&(t.spd.y=0);let e=pI((t.x+t.w/2)/32),l=pI((t.y+t.h/2)/32);if(t.ice)for(let t=-1;t<2;t++)for(let r=-1;r<2;r++)change({l:t+l,c:r+e},new Ice(32*(r+e),32*(t+l)),300);t.tim.c<=0&&(t.dea=1),t.tim.c>t.tim.m&&(t.tim.c=t.tim.m),t.tim.c>0&&t.tim.c--}}class Ball extends Ent{constructor(t,r,e,l,s){super(t,r,e,l),this.a=s}drw(){let t=this;r(t.x,t.y,t.w,t.h,"red");for(let r=0;r<5;r++)par.push(new Par(t,"ora"))}die(){let t=this;if(t.CWL())return 1;for(var r=0;r<lvls[clv].boxes.length;r++)if(t.cld([lvls[clv].boxes[r].box]))return 1;for(r=0;r<ENE.length;r++)if(ENE[r].cld([t]))return ENE[r].lif.c-=100,1}upd(){let t=this;t.x+=10*cos(t.a),t.y+=10*sin(t.a);let r={c:pI((t.x+t.w/2)/32),l:pI((t.y+t.h/2)/32)};"Ice"==lvls[clv].map.arr[r.l][r.c].constructor.name&&change(r,new flr(32*r.c,32*r.l),30)}}class DBal extends Ball{constructor(t,r,e,l,s){super(t,r,e,l,s),this.x+=this.w/2}die(){let t=this;if(t.CWL())return 1;for(var r=0;r<lvls[clv].boxes.length;r++)if(t.cld([lvls[clv].boxes[r].box]))return 1;return pla.cld([t])?(pla.tim.c-=30,1):void 0}upd(){let t=this;super.drw(),t.x+=15*cos(t.a),t.y+=15*sin(t.a);let r=pI((t.x+t.w/2)/32),e=pI((t.y+t.h/2)/32);!lvls[clv].map.arr[e][r].uFr&&(lvls[clv].map.arr[e][r].uFr=1)}}class Met{constructor(t,r,e,l,s){let n=this;n.dtx=t,n.dty=r,n.w=e,n.h=l,n.a=s,n.x=-400*cos(s)+t,n.y=-400*sin(s)+r-l}upd(){let t=this;r(t.x,t.y,t.w,t.h,"rgb(161, 81, 35)");for(let r=0;r<5;r++)par.push(new Par(t,"ora"));t.x+=10*cos(t.a),t.y+=10*sin(t.a),bal(t.dtx,t.dty,50,"rgba(255,0,0,"+100*t.y/t.dty/5/100+")")}}class Box extends Ent{constructor(t,r){super(t,r,64,64),this.spX=t,this.spY=r}psh(t){this.spd.x=t.spd.x,this.spd.y=t.spd.y}drw(){box(this)}upd(){let t=this;t.x+=t.spd.x,t.y+=t.spd.y,t.CWL()&&(t.x-=t.spd.x,t.y-=t.spd.y,t.spd.x=0,t.spd.y=0),t.spd.x*=t.fri,t.spd.y*=t.fri,abs(t.spd.x)<.05&&(t.spd.x=0),abs(t.spd.y)<.05&&(t.spd.y=0)}}class Ene extends Ent{constructor(t,r,e,l){super(t,r,e,l);let s=this;s.anC=0,s.gra=0,s.spe=1,s.spV=new Vec(0,0),s.acV=new Vec(0,0),s.sVM=2,s.tVM=1.25,s.r=50,s.raE=50,s.raP=400,s.rPM=600,s.wH=1,s.wHa=1}die(){return this.dea}wlk(t,r){this.x+=t,this.y+=r}lfB(t){if(t.anC>=15&&(t.dea=1,pla.tim.c+=t.rec,enC++),t.lif.c<=0){t.anC+=1;for(let r=0;r<5;r++)par.push(new Par(t,"red"));return blo.push(new Blo(t)),zzfx(...[,,31,.04,.1,.71,4,.1,5,6,,,,1.1,,1,,.35,.25,.19]),1}}upd(){let t=this,r=new Vec(0,0),e=new Vec(0,0),l=0;for(let s of ENE){let n=sqr((t.x+t.w/2-(s.x+s.w/2))**2+(t.y+t.h/2-(s.y+s.h/2))**2),c=sqr((t.x+t.w/2-(pla.x+pla.w/2))**2+(t.y+t.h/2-(pla.y+pla.h/2))**2);if(c<=t.raP?(e=new Vec(pla.x+pla.w/2-(t.x+t.w/2),pla.y+pla.h/2-(t.y+t.h/2)),t.raP=t.rPM):t.raP>150&&(t.raP-=.2),t!=s&&n<=t.raP&&(s.raP>t.raP||t.raP>s.raP)&&(s.raP=t.raP),t!=s&&n<=t.raE){let e=new Vec(t.x+t.w/2-(s.x+s.w/2),t.y+t.h/2-(s.y+t.h/2));l++,r.sum(e)}l&&r.div(l);let a=sqr(r.x**2+r.y**2);a&&r.div(a),r.mtp(t.spe*t.sVM);let h=sqr(e.x**2+e.y**2);h&&e.div(h),e.mtp(t.spe*t.tVM),t.acV.sum(r),t.acV.sum(e),t.spV.sum(t.acV),t.spV.lim(t.spe),c<28&&(pla.tim.c-=t.dmg,t.wlk(-t.spV.x,-t.spV.y)),t.anC&&(t.spV.mtp(0),e.mtp(0)),t.d=e,t.spd=e}t.wlk(t.spV.x,t.spV.y),t.CWL()&&t.wlk(-t.spV.x,-t.spV.y);for(var s=0;s<lvls[clv].boxes.length;s++)t.cld([lvls[clv].boxes[s].box])&&(lvls[clv].boxes[s].box.psh(t,t.d.x,t.d.y),t.wlk(-t.spV.x,-t.spV.y));t.acV.mtp(0),t.spV.x*=t.fri,t.spV.y*=t.fri,t.spV.x<.1&&(t.spV.x=0),t.spV.y<.1&&(t.spV.y=0)}}class Min extends Ene{constructor(t,r,e,l){super(t,r,e,l);let s=this;s.lif={m:100,c:100},s.rec=60,s.dmg=.5}sid(){let t=this;cha(t),le1(t,t.cn,zC),mov(t),bdS(t,"#5C0C0C","#5C0C0C",1,t.anC),res(),hs2(t,t.cn,zC,0,0),le2(t,t.cn,zC,0),res()}bac(){let t=this;HAN(t,t.cn,zC,0),leg(t,t.cn<0?.8:t.cn?1.2:1,t.cn>0?.8:t.cn?1.2:1,zC,zC,0),mov(t),bdB(t,"#5C0C0C","#5C0C0C",1),res()}fro(){let t=this;mov(t),bdB(t,"#5C0C0C","#5C0C0C",1),ZhF(t,t.anC),res(),HAN(t,t.cn,zC,0),leg(t,t.cn<0?.8:t.cn?1.2:1,t.cn>0?.8:t.cn?1.2:1,zC,zC,0)}drw(){let t=this;super.drw(),!t.lfB(t)&&(lB(t,wh,t.h/4,3,3,0),lB(t,"red",t.h/4,3,3,1))}}class Cur extends Ene{constructor(t,r,e,l){super(t,r,e,l);let s=this;s.lif={m:200,c:200},s.spd.x=0,s.rec=pla.tim.m,s.dmg=1}sid(){let t=this;cha(t),le1(t,t.cn,zC),hs1(t,t.cn,zC),mov(t),heS(t,1),bdS(t,"#5C0C0C","#B40F0F",0,t.anC),res(),hs2(t,t.cn,wh,0,1),le2(t,t.cn,wh,1),res()}bac(){let t=this;han(t,t.cn,3*t.w/4,0,zC,0),han(t,-t.cn,0,0,wh,1),leg(t,t.cn<0?.8:t.cn?1.2:1,t.cn>0?.8:t.cn?1.2:1,wh,zC,0),mov(t),heB(t,1),bdB(t,"#5C0C0C","#B40F0F",0),res()}fro(){let t=this;mov(t),bdB(t,"#5C0C0C","#5C0C0C",1),heF(t,t.anC),cHe(t,t.anC),siJ(t,"#B40F0F"),res(),han(t,t.cn,3*t.w/4,0,wh,1),han(t,-t.cn,0,0,zC,0),leg(t,t.cn<0?.8:t.cn?1.2:1,t.cn>0?.8:t.cn?1.2:1,zC,wh,1)}drw(){let t=this;super.drw(),!t.lfB(t)&&(lB(t,wh,t.h/1.3,5,3,0),lB(t,"red",t.h/1.3,5,3,1))}}class Dre extends Ene{constructor(t,r,e,l){super(t,r,e,l);let s=this;s.lif={m:5e3,c:5e3},s.spd.x=1,s.sVM*=-1,s.tVM*=-1,s.tpt=[],s.tpc={c:0,m:150},s.tpc.c=s.tpc.m,s.ats=[new Atk("Frb",2,0,.5),new Atk("Ice",6,0),new Atk("Mtr",5,0,.5)],s.bal=[],s.mtT=[],s.mtr=[]}sid(){let t=this;cha(t),gaS(t,t.cn),tra(0,t.cn/8),Dbd(t,1),spk(t,0),spk(t,t.w/3),spk(t,t.w/1.6),tra(0,-t.cn/8),stf(t,t.cn/5),hs2(t,t.cn/5,blk,0,0),res();for(let r=0;r<10;r++)par.push(new Par(t,"bla"))}fro(){let t=this;tra(0,t.cn/8),DFb(t,t.cn),DFh(t,t.cn),tra(0,-t.cn/8),HAN(t,t.cn,blk,0),stf(t,t.cn),gau(t,t.cn,0);for(let r=0;r<10;r++)par.push(new Par(t,"bla"))}bac(){let t=this;stf(t,-t.cn,1),HAN(t,t.cn,blk,0),gau(t,-t.cn,3*t.w/4),tra(0,t.cn/8),Dbd(t,0,1),spk(t,0),spk(t,t.w/3),spk(t,t.w/1.6),tra(0,-t.cn/8);for(let r=0;r<10;r++)par.push(new Par(t,"bla"))}tlp(){let t=this;t.tpt=[],sgr("flr",lvls[clv].map.arr,t.tpt);var r=t.tpt[pI(rng()*t.tpt.length)];t.x=r.x-t.w/2,t.y=r.y-t.h/2;let e=sqr((t.x+t.w/2-(pla.x+pla.w/2))**2+(t.y+t.h/2-(pla.y+pla.h/2))**2);(t.CWL()||null==r.x||null==r.y||e<250||e>700)&&t.tlp()}raG(){let t=this,r=M.floor(rng()*t.ats.length);switch(t.ats[r].nam){case"Frb":t.ats[0].act=1,t.ats[0].tmr.c=t.ats[0].tmr.m,t.ats[0].atm.c=t.ats[0].atm.m,adT("Die!;","purple",100);break;case"Ice":t.ats[1].act=1,t.ats[1].tmr.c=t.ats[1].tmr.m,adT("Freeze, insect!;","purple",100);break;case"Mtr":t.ats[2].act=1,t.ats[2].tmr.c=t.ats[2].tmr.m,t.ats[2].atm.c=t.ats[2].atm.m,sgr("flr",lvls[clv].map.arr,t.mtT),adT("Behold the heaven's wrath!;","purple",100)}}sFb(){let t=this;t.ats[0].tmr.c--,t.ats[0].atm.c--;var r=M.atan2(pla.y-t.y,pla.x-(t.x+t.w/2));!t.ats[0].atm.c&&(t.bal.push(new DBal(t.x,t.y,40,40,r)),t.ats[0].atm.c=t.ats[0].atm.m),!t.ats[0].tmr.c&&(t.ats[0].act=0)}sIc(){let t=this;t.ats[1].tmr.c--,!t.ats[1].tmr.c&&(t.ats[1].act=0,pla.ice=0)}sMt(){let t=this;t.ats[2].tmr.c--,t.ats[2].atm.c--;var r=t.mtT[pI(rng()*t.mtT.length)];!t.ats[2].atm.c&&(t.mtr.push(new Met(r.x,r.y,40,40,135*M.PI/180)),t.ats[2].atm.c=t.ats[2].atm.m),!t.ats[2].tmr.c&&(t.ats[2].act=0,t.mtT=[])}drw(){let t=this;super.drw(),!t.lfB(t)&&(lB(t,wh,t.h/1.5,5,4,0),lB(t,"purple",t.h/1.5,5,4,1))}upd(){let t=this;t.tpc.c>0?t.tpc.c--:(t.tpc.c=t.tpc.m,t.raG(),t.tlp()),super.upd(t),t.ats[0].act&&t.sFb(),t.ats[1].act&&(pla.ice=1,t.sIc()),t.ats[2].act&&t.sMt();for(let r=0;r<t.mtr.length;r++)t.mtr[r].upd(),(t.mtr[r].y+t.mtr[r].h/2>=t.mtr[r].dty||t.mtr.x<=t.mtr[r].dtx)&&(t.mtr.splice(r,1),r--);upT(t.bal)}}function fill(t){return Array.from({length:24},(r=>Array.from({length:32},(r=>t))))}function cma(t){for(var r=0;r<t.length;r++)for(var e=0;e<t[r].length;e++)switch(Number(t[r][e])){case 1:t[r][e]=new flr(32*e,32*r);break;case 2:t[r][e]=new Wal(32*e,32*r);break;case 3:t[r][e]=new dor(32*e,32*r);break;case 4:t[r][e]=new Spw(32*e,32*r);break;case 5:t[r][e]=new Bxs(32*e,32*r);break;case 6:t[r][e]=new Btn(32*e,32*r,[!1,!0]);break;case 7:t[r][e]=new BDT(32*e,32*r);break;case 8:t[r][e]=new Sgn(32*e,32*r);break;case 9:t[r][e]=new Gbx(32*e,32*r);break;case 10:t[r][e]=new Gbo(32*e,32*r);break;case 11:t[r][e]=new Gdi(32*e,32*r);break;case 12:t[r][e]=new Ice(32*e,32*r);break;case 13:t[r][e]=new Mor(32*e,32*r,[".","_"],M.round(rng()));break;case 14:t[r][e]=new Mth(32*e,32*r,"Dgt",!1);break;case 15:t[r][e]=new Mth(32*e,32*r,"Add",!0);break;case 16:t[r][e]=new Mth(32*e,32*r,"Sub",!0);break;case 17:t[r][e]=new Mth(32*e,32*r,"Mul",!0);break;case 18:t[r][e]=new Mth(32*e,32*r,"Div",!0);break;case 19:t[r][e]=new Mth(32*e,32*r,"Res",!0);break;case 20:t[r][e]=new Mth(32*e,32*r,"Ans",!0);break;case 21:t[r][e]=new Cnt(32*e,32*r);break;case 22:t[r][e]=new F13(32*e,32*r)}}var levels=[{x:520,y:672},{x:845,y:672},{x:499.2,y:672},{x:819,y:672},{x:845,y:672},{x:845,y:672},{x:499.2,y:672},{x:819,y:672}];function sqlv(t){for(var r=0;r<cnv.height/32;r++)t[r][0]=t[r][31]=2;for(var e=1;e<cnv.width/32-1;e++)t[0][e]=t[23][e]=2}function Llvl(t){sqlv(t);for(var r=0;r<23;r++)t[11][r]=2;for(var e=12;e<24;e++)t[e][22]=2;for(r=0;r<22;r++)for(e=12;e<24;e++)t[e][r]=0;t[0][16]=t[0][15]=3,t[2][22]=t[1][1]=t[22][30]=4}function Tlvl(t){sqlv(t);for(var r=1;r<16;r++)for(var e=0;e<13;e++)t[r+8][e+19]=t[r+8][e]=0;for(e=0;e<13;e++)t[9][e+19]=t[9][e]=2;for(r=10;r<24;r++)t[r][12]=t[r][19]=2;t[0][16]=t[0][15]=3,t[5][5]=t[5][25]=4}function Hlvl(t){sqlv(t);for(var r=0;r<8;r++)for(var e=11;e<21;e++)t[r][e]=t[r+16][e]=0;for(e=11;e<21;e++)t[16][e]=t[7][e]=2;for(r=0;r<7;r++)t[r][11]=t[r][20]=t[r+17][11]=t[r+17][20]=2;t[0][6]=t[0][5]=3,t[12][3]=t[2][23]=t[1][1]=t[22][30]=4}function Clvl(t){sqlv(t),t[0][16]=t[0][15]=2;for(var r=7;r<17;r++)for(var e=10;e<32;e++)t[r][e]=0;for(e=10;e<32;e++)t[16][e]=t[7][e]=2;for(r=8;r<16;r++)t[r][10]=2;t[0][26]=t[0][25]=3,t[4][9]=t[16][2]=t[17][30]=t[6][30]=4}function lv1(t){sqlv(t),t[5][5]=t[17][25]=4,t[0][16]=t[0][15]=3;return t[2][12]=new Sgn(384,64,"Well met, T’reze!;You hast reached the Tower of Dreizehn!;May the number thirteen bless your journey...;"),t[2][19]=new Sgn(608,64,"The sword you wield in your hand holds great power T’reze.;but everything has a price... If you dont feed the sword with souls...; In thirteen seconds she will feed on your own soul!;"),t[0][23]=21,Ddi(t),t}function lv2(t){return Llvl(t),t[3][5]=t[6][28]=t[9][9]=t[9][15]=5,t[7][1]=t[16][30]=t[2][17]=t[2][14]=7,t[9][1]=t[10][2]=t[10][1]=t[2][23]=t[2][24]=t[1][24]=t[1][25]=t[16][24]=t[16][23]=t[15][23]=9,t[10][3]=t[9][2]=t[8][1]=t[2][25]=t[1][22]=t[1][23]=t[1][26]=t[13][23]=t[14][24]=t[15][24]=t[14][23]=10,Ddi(t),t}function lv3(t){return Tlvl(t),t[0][23]=21,Ddi(t),t}function lv4(t){Hlvl(t);return t[4][26]=new Sgn(832,128,".-- .-. .. - . / - .... . / -. ..- -- -... . .-. / --- ..-. / - .... . / -.-. ..- .-. ... .;- .... .- - / -.. --- - .... / - .- .. -. - / -.-- --- ..- .-. / .-.. .. ..-. . .-.-.- .-.-.- .-.-.-;"),t[10][10]=t[10][11]=t[10][12]=t[10][13]=t[10][14]=t[10][17]=t[10][18]=t[10][19]=t[10][20]=t[10][21]=13,Ddi(t),t}function lv5(t){return Clvl(t),t[12][8]=t[6][3]=t[18][28]=t[4][29]=6,Ddi(t),t}function lv6(t){return Llvl(t),t[0][20]=21,Ddi(t),t}function lv7(t){return Tlvl(t),t[4][22]=14,t[4][23]=17,t[4][24]=new Mth(768,128,"Dgt",!0,3),t[4][25]=15,t[4][26]=14,t[4][27]=19,t[4][28]=20,Ddi(t),t}function lv8(t){return Hlvl(t),t[0][26]=21,t}function lv13(t){return sqlv(t),t[6][7]=t[6][8]=t[16][7]=t[16][8]=t[16][12]=t[16][11]=t[16][20]=t[16][21]=t[16][22]=t[16][23]=t[15][23]=t[14][23]=t[13][23]=t[10][23]=t[9][23]=t[8][23]=t[7][23]=t[7][22]=t[7][21]=t[7][20]=t[12][19]=t[11][19]=t[12][20]=t[11][20]=t[12][21]=t[11][21]=t[12][22]=t[11][22]=t[12][23]=t[11][23]=t[7][19]=t[6][19]=t[6][20]=t[6][21]=t[6][22]=t[6][23]=t[6][24]=t[7][24]=t[8][24]=t[9][24]=t[10][24]=t[11][24]=t[12][24]=t[13][24]=t[14][24]=t[15][24]=t[16][24]=t[17][24]=t[17][23]=t[17][22]=t[17][21]=t[17][20]=t[16][19]=t[17][19]=t[17][12]=t[17][7]=t[17][8]=t[17][11]=t[17][10]=t[17][9]=t[17][10]=t[16][9]=t[16][10]=t[15][9]=t[15][10]=t[14][9]=t[14][10]=t[13][9]=t[13][10]=t[12][9]=t[12][10]=t[11][9]=t[11][10]=t[10][9]=t[10][10]=t[9][9]=t[9][10]=t[8][9]=t[8][10]=t[7][7]=t[7][8]=t[7][9]=t[7][10]=t[6][10]=t[6][9]=22,Ddi(t),t}function random(t,r,e){var l=pI(4*rng()),s=pI(3*rng());switch(l){case 0:Llvl(t),levels.push({x:845,y:672});break;case 1:Tlvl(t),levels.push({x:499.2,y:672});break;case 2:Hlvl(t),levels.push({x:819,y:672});break;case 3:Clvl(t),levels.push({x:845,y:672})}var n=[[14,15,new Mth(0,0,"Dgt",!0,10),16,14,19,20],[14,17,new Mth(0,0,"Dgt",!0,2),16,14,19,20],[14,17,new Mth(0,0,"Dgt",!0,6),15,14,19,20],[14,18,new Mth(0,0,"Dgt",!0,3),15,14,19,20],[14,16,new Mth(0,0,"Dgt",!0,15),15,14,19,20]];let c=-1!=t[1].indexOf(1);switch(s){case 0:for(var a=0;a<2;)a=pI(5*rng());adran(t,a,5),adran(t,a,7),r.c=BTU;break;case 1:for(a=0;a<3;)a=pI(4*rng());adran(t,a,6),r.c=BTNS;break;case 2:for(e=0;e<1;){var h=pI(22*rng()),i=pI(30*rng());if(1==t[h][i]&&1==t[h][i+1]&&1==t[h][i+2]&&1==t[h][i+3]&&1==t[h][i+4]&&1==t[h][i+5]&&1==t[h][i+6]&&1==t[h][i+7]||12==t[h][i]&&12==t[h][i+12]&&12==t[h][i+2]&&12==t[h][i+3]&&12==t[h][i+4]&&12==t[h][i+5]&&12==t[h][i+6]&&12==t[h][i+7]){for(var w=pI(rng()*n.length),x=0;x<7;x++)"Number"==n[w][x].constructor.name?t[h][i+x]=n[w][x]:(t[h][i+x]=n[w][x],t[h][i+x].x=32*(i+x),t[h][i+x].y=32*h);e++}}r.c=MAT}return c&&Ddi(t),t}function KCT(){enC>=13&&(cpd=1)}function BTU(t){var r=0;for(let e=0;e<t.boxT.length;e++)t.boxT[e].act&&r++;cpd=r==t.boxT.length&&0!=r?1:0}function MORS(t){for(var r=0,e=0;e<t.mor.length;e++)if(t.mor[e].val[t.mor[e].i%t.mor[e].val.length]==t.txt[e]&&r++,r==t.mor.length){for(var l=0;l<t.mor.length;l++)t.mor[l].clr="green";cpd=1}else for(l=0;l<t.mor.length;l++)t.mor[l].clr="red",cpd=0}var nxt=0;function BTNS(t){return nxt==t.btns.length&&(cpd=1,nxt=0),nxt}function MAT(t){var r="";if(t.maAr.length){for(let e=0;e<t.maAr.length-2;e++)r+=t.maAr[e].dgt;for(let e=0;e<t.maAr.length;e++)t.maAr[e].fix?t.maAr[e].txC="black":t.maAr[e].txC="crimson",cpd=0,Function("return pI("+r+")==13")()&&(t.maAr[e].txC="green",cpd=1,console.log("mat"))}}class lvl{constructor(t,r,e,l,s,n){let c=this;if(c.map=t,c.c=n,s){switch(pI(3*rng())){case 0:r=1;break;case 1:e=1;break;case 2:c.map.arr=fill(12)}random(c.map.arr,c)}cma(c.map.arr),c.boxes=[],c.btns=[],c.b=r,c.r=e,c.boxT=[],c.maAr=[],c.mor=[],c.spw=[],sgr("Spw",c.map.arr,c.spw),sgr("Mor",c.map.arr,c.mor),sgr("Bxs",c.map.arr,c.boxes),sgr("Btn",c.map.arr,c.btns),sgr("BDT",c.map.arr,c.boxT),sgr("Mth",c.map.arr,c.maAr),shf(c.btns),c.mor.sort(((t,r)=>t.x-r.x));for(let t=0;t<c.spw.length;t++)c.spw[t].spT=30*l.t,c.spw[t].enL=l.l;c.txt=".____...__"}upd(){let t=this;bli=t.b,rev=t.r,t.map.upd(),t.c(t)}}class Map{constructor(t){this.arr=t}upd(){let t=this;for(var r=0;r<t.arr.length;r++)for(var e=0;e<t.arr[r].length;e++)t.arr[r][e]&&d(t.arr[r][e],32,32)&&t.arr[r][e].drw(),t.arr[r][e]&&t.arr[r][e].upd()}}class Tle{constructor(t,r){let e=this;e.x=t,e.y=r,e.w=e.h=32,e.add=0,e.tim={c:0,m:90}}drw(){r(this.x,this.y,32,32,this.clr)}upd(){}collide(t){let r=this;return r.x+32>=t.x&&r.x<=t.x+t.w&&r.y+32>=t.y&&r.y<=t.y+t.h?1:0}uFr(){if(this.tim.c++,this.tim.c>this.tim.m)return this.tim.c=0,1}}class Wal extends Tle{constructor(t,r){super(t,r),this.col=1}drw(){let t=this;nex(t,1,0)&&nex(t,-1,0)?t.drw=function(){gr(t),waF(t)}:nex(t,0,-1)&&nex(t,0,1)?t.drw=function(){waS(t)}:(nex(t,0,-1)||nex(t,0,1)||(t.drw=function(){waS(t),r(t.x,t.y+t.h-1,t.w,1,"#6D798B"),r(t.x,t.y,t.w,1,"#6D798B")}),nex(t,0,-1)&&(t.drw=function(){waS(t),r(t.x,t.y+t.h-1,t.w,1,"#6D798B")}),nex(t,0,1)&&(t.drw=function(){waS(t),r(t.x,t.y,t.w,1,"#6D798B")}))}}class flr extends Tle{constructor(t,r){super(t,r)}upd(){for(var t=0;t<fric.length;t++)this.collide(fric[t])&&(fric[t].fri=0,fric[t].acel=5)}drw(){gr(this)}}class dor extends Tle{constructor(t,r){super(t,r),this.clr="#6b5421"}drw(){super.drw(),cpd&&gr(this)}upd(){let t={x:pla.x-5,y:pla.y-5,w:pla.w+10,h:pla.h+10};this.collide(t)&&cpd&&(clv++,pla.x=levels[clv].x,pla.y=levels[clv].y,pla.tim.c=pla.tim.m,ENE=[],blo=[],par=[],pla.bal=[],cpd=0,tles2=[],tles=[],endTimes=[],times=[],mps=[],enC=0,12==clv&&ENE.push(new Dre(cnv.width/2,cnv.height/2,128,128)))}}class Spw extends Tle{constructor(t,r){super(t,r);let e=this;e.enL=0,e.spT=0,e.cuT=0,e.c=0}arT(){let t=this;t.cuT==t.spT&&(rng()<.9?ENE.push(new Min(t.x,t.y,64,64,t)):ENE.push(new Cur(t.x,t.y,64,64,t)),t.cuT=0,t.c++),t.cuT++}drw(){gr(this),spw(this)}upd(){this.enL>=ENE.length&&this.arT()}}class Btn extends Tle{constructor(t,r){super(t,r),this.clr="red",this.cld=0}upd(){let t=this;if(t.collide(pla)){if(lvls[clv].btns[nxt]!=t||t.cld){if(!t.cld){for(var r=0;r<lvls[clv].btns.length;r++)lvls[clv].btns[r].clr="red";nxt=0}}else t.clr="green",nxt++;t.cld=1,4==nxt&&(cpd=1)}else t.cld=0}drw(){gr(this),btn(this,this.clr)}}class Mor extends Tle{constructor(t,r,e,l){super(t,r);let s=this;s.clr="red",s.cld=0,s.val=e,s.i=l}drw(){let t=this;gr(t),btn(t,t.clr),mor(t)}upd(){let t=this;sqr((t.x+t.w/2-(pla.x+pla.w/2))**2+(t.y+t.h/2-(pla.y+pla.h/2))**2)<50&&(pla.int=1,key[69]&&(t.i++,key[69]=!key[69]))}}class Bxs extends Tle{constructor(t,r){super(t,r);let e=this;e.clr="#FF9633",e.box=new Box(e.x,e.y)}}class BDT extends Tle{constructor(t,r){super(t,r),this.act=0,this.clr="purple"}bCD(){let t=this;for(var r=lvls[clv].boxes.length,e=0;e<r;e++)if(t.x+32>=lvls[clv].boxes[e].box.x&&t.x<=lvls[clv].boxes[e].box.x+lvls[clv].boxes[e].box.w&&t.y+32>=lvls[clv].boxes[e].box.y&&t.y<=lvls[clv].boxes[e].box.y+lvls[clv].boxes[e].box.h)return 1}upd(){let t=this;t.act=t.bCD(),t.bCD()?t.clr="green":t.clr="red"}drw(){gr(this),bdt(this,this.clr)}}class Sgn extends Tle{constructor(t,r,e){super(t,r),this.clr="#7C653C",this.col=1,this.txt=e}drw(){gr(this),sgn(this)}upd(){let t=this;sqr((t.x+t.w/2-(pla.x+pla.w/2))**2+(t.y+t.h/2-(pla.y+pla.h/2))**2)<50&&(key[69]&&adT(t.txt,"black",100),pla.int=1)}}class Ice extends Tle{constructor(t,r){super(t,r)}upd(){for(var t=0;t<fric.length;t++)this.collide(fric[t])&&(fric[t].fri=.99,fric[t].acel=.1)}drw(){r(this.x,this.y,32,32,"lightblue")}}class Mth extends Tle{constructor(t,r,e,l,s){super(t,r);let n=this;switch(n.typ=e,n.fix=l,n.fix?n.txC="black":n.txC="crimson",n.val=0,n.typ){case"Dgt":n.fix?n.val=s%21:n.val=M.floor(21*rng()),n.dgt=n.val;break;case"Add":n.dgt="+";break;case"Sub":n.dgt="-";break;case"Mul":n.dgt="*";break;case"Div":n.dgt="/";break;case"Res":n.dgt="=";break;case"Ans":n.dgt=13}n.str=n.val}opr(t,r){let e=this;switch(e.typ){case"Add":r.str=t.str+r.val;break;case"Sub":r.str=t.str-r.val;break;case"Mul":r.str=t.str*r.val;break;case"Div":r.str=t.str/r.val;break;case"Res":e.str=t.str,r.str=t.str;break;case"Ans":e.str=e.dgt=e.val=13}}chg(t){return t}drw(){let t=this;mat(t),txt(t.x+t.w/2,t.y+t.h/2,t.dgt,t.w/1.5,t.txC)}upd(){let t=this;sqr((t.x+t.w/2-(pla.x+pla.w/2))**2+(t.y+t.h/2-(pla.y+pla.h/2))**2)<50&&!t.fix&&(pla.int=1,key[69]&&(t.val++,t.val%=21,t.dgt=t.val,t.str=t.val,key[69]=0))}}class Gbx extends Tle{constructor(t,r){super(t,r);let e=this;e.col=1,e.bx1={x:e.x,y:e.y,w:e.w,h:e.h},e.bx2={x:e.x,y:e.y-e.h/1.4,w:e.w,h:e.h}}drw(){box(this.bx1),box(this.bx2)}}class Gbo extends Tle{constructor(t,r){super(t,r),this.col=1}drw(){box(this)}}class Gdi extends Tle{constructor(t,r){super(t,r),this.r=90*pI(4*rng())}drw(){gr(this),sB(3,"black"),dir(this,this.r),sB(0)}}class Cnt extends Tle{constructor(t,r){super(t,r),this.c="white",this.cnt=0,this.col=1}drw(){let t=this;waS(t),enC<=13&&(t.cnt=enC),13==t.cnt&&(t.c="green"),cnt(t,t.cnt,t.c)}}class F13 extends Tle{constructor(t,r){super(t,r)}drw(){this.clr=c13,super.drw()}}var bli=0,lvls=[new lvl(new Map(lv1(fill(1))),0,0,{t:3,l:50},0,KCT),new lvl(new Map(lv2(fill(1))),0,0,{t:3,l:50},0,BTU),new lvl(new Map(lv3(fill(1))),1,0,{t:3,l:50},0,KCT),new lvl(new Map(lv4(fill(1))),0,0,{t:3,l:50},0,MORS),new lvl(new Map(lv5(fill(1))),0,0,{t:1,l:50},0,BTNS),new lvl(new Map(lv6(fill(1))),0,1,{t:1,l:50},0,KCT),new lvl(new Map(lv7(fill(1))),0,0,{t:1,l:50},0,MAT),new lvl(new Map(lv8(fill(12))),0,0,{t:1,l:50},0,KCT),new lvl(new Map(fill(1)),0,0,{t:1,l:50},1),new lvl(new Map(fill(1)),0,0,{t:1,l:50},1),new lvl(new Map(fill(1)),0,0,{t:1,l:50},1),new lvl(new Map(fill(1)),0,0,{t:1,l:50},1),new lvl(new Map(lv13(fill(1))),0,0,{t:1,l:50},0,(function(){}))],tBX={t:0,sTX:"",aTX:"",clr:"",cTM:0},ENE=[],par=[],blo=[],clv=0,enC=0,c13="green",cpd=0,dis=(nxt=0,200),rev=0,tim=setInterval(menu,1e3/30),pla=new Pla(cnv.width/2,cnv.height/3,64,64),All=[],fric=[],hud=new Hud,t=new Vec(0,0),plM=new Pla(cnv.width/2-100,cnv.height/2+100,400,400),a={x:-127.5,y:500,w:1.25*cnv.width,h:1.25*cnv.width},b={x:cnv.width/2-cnv.width/3/2,y:650,w:cnv.width/3,lif:{c:0,m:0}},p={x:0,y:0,w:cnv.width,h:cnv.height},dBg=0,dSb=100,dt1=0,dt2=0,dSw={x:cnv.width/2,y:cnv.height/2,w:200,h:200};const bu=zzfxM([[1.5,0,130.8128,.03,.4,.27,1,.5,,,,,,.1,,,.07,.64,.04,,107],[1.1,0,65.40639,.04,.91,.06,,1.2,,,,,.4,.1,,,,.52,.09,.22],[1.3,0,65.40639132514966,,.02,,,1.5,,,,,,5,,,,.7,.02],[.5,0,260,,,.04,,,,,,,.1,99,,,,2,.005,.2]],[[[0,0,12,0,0,0,0,0,0,-1,13,0,0,0,0,0,0,-1],[0,0,,,,,15,0,0,0,0,0,0,-1,15,0,0,0],[2,0,12,-1,,,,,,,84,-1,,,,,,],[3,0,,,,,12,-1,,,,,,,12,-1,,]]],[0],120);bu.loop=1;var mu=zzfxP(...bu);function menu(){r(0,0,cnv.width,cnv.height,"black");for(let t=0;t<20;t++)par.push(new Par(p,"pur",0,1));for(let t=0;t<par.length;t++)d(par[t],0,0)&&par[t].drw();upT(par),sB(15,"purple"),DFb(a),DFh(a),sB(0,"purple"),sB(10,"purple"),txt(cnv.width/2,cnv.height/8,"13-Seconds-To-Kill",cnv.width/10,"purple"),sB(0),plM.drw(),sB(10,"red"),lB(b,"purple",75,105,30,0),lB(b,wh,75,100,25,0),txt(cnv.width/2,cnv.height/1.34,"press space to play",40,blk),sB(0),key[32]&&(clearInterval(tim),tim=setInterval(loop,1e3/30))}function loop(){r(0,0,cnv.width,cnv.height,"black"),fric=ENE.concat(pla,adi("box",lvls[clv].boxes)),lvls[clv].upd();for(let t=0;t<blo.length;t++)d(blo[t],0,0)&&blo[t].drw();(All=ENE.concat(pla,pla.bal,adi("box",lvls[clv].boxes))).sort(((t,r)=>t.y-r.y));for(let t=0;t<All.length;t++)d(All[t],All[t].w,All[t].h)&&All[t].drw();for(let t=0;t<par.length;t++)d(par[t],0,0)&&par[t].drw();for(var t=0;t<adi("box",lvls[clv].boxes).length;t++)adi("box",lvls[clv].boxes)[t].upd();upT(pla.bal),upT(ENE),upT(par),pla.upd(),!pla.dea&&(ang=M.atan2(mou.y-pla.y,mou.x-(pla.x+pla.w/2))+M.PI*rev||M.PI/2),pla.d.x=cos(ang),pla.d.y=sin(ang),key[87-4*rev]&&pla.spd.y>-pla.msp&&(pla.spd.y-=pla.acel),key[83+4*rev]&&pla.spd.y<pla.msp&&(pla.spd.y+=pla.acel),key[65+3*rev]&&pla.spd.x>-pla.msp&&(pla.spd.x-=pla.acel),key[68-3*rev]&&pla.spd.x<pla.msp&&(pla.spd.x+=pla.acel),hud.drw(),r(0,0,cnv.width*rev,cnv.height*rev,"rgba(75,0,130,0.4)"),drug(),times&&count(),tBX.t?(dlg(tBX.sTX,tBX.clr,tBX.t),tBX.t--,document.addEventListener("keyup",dS)):""!=tBX.aTX&&adT(tBX.aTX,tBX.clr,tBX.cTM)}function dead(){if(dBg<100){dBg++,r(0,0,cnv.width,cnv.height,"black"),lvls[clv].drw();for(let t=0;t<blo.length;t++)d(blo[t],0,0)&&blo[t].drw();(All=ENE.concat(pla,pla.bal,adi("box",lvls[clv].boxes))).sort(((t,r)=>t.y-r.y));for(let t=0;t<All.length;t++)d(All[t],All[t].w,All[t].h)&&All[t].drw();for(let t=0;t<par.length;t++)d(par[t],0,0)&&par[t].drw();for(var t=0;t<adi("box",lvls[clv].boxes).length;t++)adi("box",lvls[clv].boxes)[t].upd();upT(pla.bal),upT(ENE),pla.upd(),upT(par),99==dBg&&(par=[])}else dt1<100?dt1++:dt2<100&&(dt2+=5);if(r(0,0,cnv.width,cnv.height,"rgba(0,0,0,"+dBg/100+")"),dt1>50){dSb-=2,swo(dSw,dSw.x-25,0,0,"red",1);for(let t=0;t<par.length;t++)d(par[t],0,0)&&par[t].drw();upT(par),r(0,0,cnv.width,cnv.height,"rgba(0,0,0,"+dSb/100+")")}sB(10,"purple"),txt(cnv.width/2,cnv.height-100,"You are dead.",cnv.width/30,"rgba(255,0,0,"+dt1/100+")"),txt(cnv.width/2,cnv.height-50,"The sword lays claim to your soul.",cnv.width/30,"rgba(255,0,0,"+dt1/100+")"),txt(cnv.width/2,150,"Press space to restart.",cnv.width/30,"rgba(255,0,0,"+dt2/100+")"),sB(0,"purple"),100==dt2&&key[32]&&window.location.reload()}mu.loop=1;